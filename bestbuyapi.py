from bs4 import BeautifulSoup
from tabulate import tabulate 
import time
import json
import requests
import bestbuysku
import pandas as pd
URL="https://api.bestbuy.com/v1/products(sku%20in("
#SKUs=['6426149', '6430161', '6428324', '6430277', '6407309', '6476227', '6478369', '6439402', '6429440', '6460664', '6453897', '5901353', '6477077', '6471286', '6475148', '6457632', '6475224', '6471285', '6467497', '6471615', '6467779', '6457993', '6472637', '6466561', '6457994', '6475237', '6472646', '6475154', '6471960', '6471621', '6475153', '6434198', '6466931', '6479528', '6468926', '6457619', '6452940', '6479524', '6467500', '6468910', '5092306', '6449499', '6468932', '6466564', '6445108', '6479686', '6480291', '6429442', '6432445', '6465803', '6467782', '6468863', '6474545', '6471957', '6468934', '6432447', '6465789', '6454329', '6454328', '6429434', '6462956', '6472500000', '6441554', '6409179', '6409171', '6397797', '6457624', '6397798', '6452573', '6409188', '6389333', '6441226', '6409180', '6437912', '6444716', '6409181', '6409183', '5507806', '6444444', '6444358', '6373500', '6440913', '6442077', '6441172', '6092641', '6442484', '6453894', '6467840', '6466932', '6471954', '6432446', '6430623', '6467289', '6454318', '6471958', '6454688', '6454689', '6453895', '6439385', '6430624', '6460666', '6467838', '6479685', '6441020', '6436219', '6437910', '6430620', '6436223', '6430143', '6430621', '6471952', '6467785', '6468933', '6453267', '6462266', '6442485', '6442585', '6444357', '6479688', '6374966', '6438279', '6202343', '6476230', '6330461', '6398005', '6457622', '6457626', '6475228', '6457620', '6475238', '6475226', '6476229', '6447182', '6471287', '6395411', '6453268', '6445157', '6482512', '6475223', '6467781', '6480308', '6430175', '6462198', '6456926', '6480289', '6430215', '6375963', '6480307', '6407305', '6290681', '6480306', '6438941', '6438943', '6411488', '6439000', '6411493', '6411498', '6474407', '6411492', '6474406', '6452222', '6302019', '6356277', '64', '6356644', '6356646', '6462017', '6420741', '6422733', '6316592', '6422732', '6449962', '6316584', '6462863', '6449964', '5845215', '6447510', '6408509', '6454978', '6454983', '6408510', '6454979', '6414216', '6353113', '6459383', '6454984', '6435263', '6422731', '6454980', '6454982', '6339076', '6468105', '6414233', '6414229', '6379164', '6303597', '6459365', '6339655', '6447507', '6447512']
SKUs=bestbuysku.allSKU
URL1="))?format=json&pageSize=100&sort=orderable&show=sku,name,regularPrice,orderable&apiKey=qhqws47nyvgze2mq3qx4jadt"


entry=[]
start=0
end=100
for l in range(0,(round(len(SKUs)/100)),1):
    getSKU50=''
    
    for i in range(start,end,1):
        getSKU50+=SKUs[i]+","
        
    getSKU50=getSKU50[:-1]
        
    
    page=requests.get(URL+getSKU50+URL1)
    time.sleep(10)
    data=page.json()
    for x in range (len(data['products'])):
        sku=data['products'][x]['sku']
        name=data['products'][x]['name']
        price=data['products'][x]['regularPrice']
        order=data['products'][x]['orderable']
        entry.append([sku,name,price,order])  
     
    if end+100<len(SKUs):
        start=end
        end+=100
        
    else:
        start=end
        end+=len(SKUs)%100
    
header=['SKU','Name','Regular Price','Status']
df=pd.DataFrame(entry,columns=header)

df.to_csv('bestbuy.csv',index=False)   